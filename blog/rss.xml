<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Ilia Kebets Blog</title>
        <link>https://kebetsi.github.io/blog</link>
        <description>Ilia Kebets Blog</description>
        <lastBuildDate>Mon, 16 Sep 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Multipart Form-data response parsing in Java and JavaScript]]></title>
            <link>https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript</link>
            <guid>https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript</guid>
            <pubDate>Mon, 16 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[In this article, I will show you how to implement an HTTP server that replies with form-data and how to parse it from the client. I will provide examples for the server in Node.js, using external libraries and native ones. For the client, I will show implementations in JS and Java.]]></description>
            <content:encoded><![CDATA[<p>In this article, I will show you how to implement an HTTP server that <strong>replies with form-data</strong> and how to parse it from the client. I will provide examples for the server in Node.js, using external libraries and native ones. For the client, I will show implementations in JS and Java.</p>
<p>All the presented code snippets can be found <a href="https://github.com/kebetsi/kebetsi.github.io/tree/main/code-snippets/2024-09-16-form-data-response#code-snippets-from-multipart-form-data-post" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>I will illustrate cases where the parts are only text and a mix of text and binary data.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Learn/Forms/Sending_and_retrieving_form_data" target="_blank" rel="noopener noreferrer">Form-data is the way browsers send the contents of the <code>&lt;form&gt;</code> element</a>. It is also the way for the HTTP protocol to send key-value data in a POST request which supports values of different formats, such as text and binary.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="form-data-with-text">Form-data with text<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#form-data-with-text" class="hash-link" aria-label="Direct link to Form-data with text" title="Direct link to Form-data with text">​</a></h2>
<p><img decoding="async" loading="lazy" alt="HTTP response of multipart/form-data with text parts" src="https://kebetsi.github.io/assets/images/form-data-txt-4474f52812c716ef1997ba01938dcdf6.webp" width="1152" height="552" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-server--with-libraries">JS server — with libraries<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#js-server--with-libraries" class="hash-link" aria-label="Direct link to JS server — with libraries" title="Direct link to JS server — with libraries">​</a></h3>
<p>We use the <a href="https://www.npmjs.com/package/express" target="_blank" rel="noopener noreferrer">express</a> and <a href="https://www.npmjs.com/package/form-data" target="_blank" rel="noopener noreferrer">form-data</a> libraries in this example for convenience.</p>
<p>We use JSON data for the text, but it can also be plain text. We append each part with its name, here <code>message1</code> and <code>message2</code> to the <code>formData</code> instance, set the required headers. Finally, we must pipe it into the response stream.</p>
<p>I had to use <code>127.0.0.1</code> instead of <code>localhost</code> for the host address on the JS server side, because the Java clients would not resolve it.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'express'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> formData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'form-data'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'9876'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'127.0.0.1'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">hello</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'world'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bar'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> requestHandler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">_</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">formData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message2'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// generates the "multipart/form-data; boundary=..." header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Content-Type'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHeaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'content-type'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Content-Length'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getLengthSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestHandler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'something bad happened'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">server is listening on </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">HOST</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">PORT</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-server--without-libraries">JS server — without libraries<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#js-server--without-libraries" class="hash-link" aria-label="Direct link to JS server — without libraries" title="Direct link to JS server — without libraries">​</a></h3>
<p>For a unit test in the Java component, I had to implement a mock server that was not using any libraries. It helped me have a better understanding of the form-data layout.</p>
<p>The body starts with the boundary string which is then used to split every part of the message. The boundary must have a length of up to 70 characters, and you can read more about it <a href="https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Then, each part is organized as follows:</p>
<ol>
<li>Starts with <code>\r\n</code></li>
<li>its header, which contains the name of the part</li>
<li>2 times <code>\r\n</code></li>
<li>its body</li>
<li>ends with <code>\r\n</code></li>
</ol>
<p>We must ensure that the body length in bytes is properly computed and not forget the <code>Content-Type</code> header.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> formData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'form-data'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'9876'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'127.0.0.1'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">hello</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'world'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bar'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">requestHandler</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">chunk</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'end'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// do something with the incoming data if needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> boundary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'---------9051914041544843365972754266'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> contentTypeHeader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">multipart/form-data; boundary=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Content-Disposition: form-data; name="message1"</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">message1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Content-Disposition: form-data; name="message2"</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">message2</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeHead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">'Content-Type'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contentTypeHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">'Content-Length'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">byteLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestHandler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'something bad happened'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">server is listening on </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">HOST</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">PORT</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client">Java client<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#java-client" class="hash-link" aria-label="Direct link to Java client" title="Direct link to Java client">​</a></h3>
<p>We start by extracting the boundary string from the <code>Content-Type</code> header, which we use to split the separate parts of the body with <code>response.body().split(...)</code>. Most client libraries will generate one for you as you saw in the previous example.</p>
<p>Then we use the <code>\r\n\r\n</code> separator to split between each part’s header and body. As you can see in the library-less server implementation above, we must trim the <code>\r\n</code> form-data boilerplate. If we are handling JSON data, we could simplify this part using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#trim--" target="_blank" rel="noopener noreferrer">String.trim()</a>.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">URI</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">URISyntaxException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpRequest</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpResponse</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpResponse</span><span class="token import punctuation" style="color:#393A34">.</span><span class="token import class-name">BodyHandlers</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">time</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Duration</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyClient</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">record</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> message1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseFormData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> contentTypeHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> responseBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> boundary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> contentTypeHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"boundary="</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> parts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> responseBody</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boundary</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> part </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> parts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Split the part into headers and body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> separatorIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> part</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"\r\n\r\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">separatorIndex </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Skip if there's no body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// I remove the first 2 bytes, representing "\r\n" before the headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">String</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> part</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> separatorIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// I remove the first 4 bytes and last 2.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// They are the "\r\n\r\n" before and "\r\n" after the payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">String</span><span class="token plain"> partBody </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> part</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">separatorIndex </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> partBody</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> partBody</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message1 </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalStateException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Data missing from response"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">HttpRequest</span><span class="token plain"> request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">HttpRequest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">url</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hello"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">HttpClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">HttpClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connectTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Duration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ofSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">HttpResponse</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BodyHandlers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ofString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> contentTypeHeader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">headers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">firstValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Content-Type"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">orElseThrow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalStateException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"No Content-Type header"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> responseBody </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">body</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseFormData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contentTypeHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> responseBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">URI</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">url</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">URISyntaxException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalStateException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Invalid URI: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">MyApiResponse</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"localhost"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9876</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// MyApiResponse[message1={"hello":"world"}, message2={"foo":"bar"}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-client">JS client<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#js-client" class="hash-link" aria-label="Direct link to JS client" title="Direct link to JS client">​</a></h3>
<p>For the HTTP request, we use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">fetch API</a> available in modern browsers and Node.js since version 18.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">host</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">http://</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">host</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/hello</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">formData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">message1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'localhost'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9876</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [ '{"hello":"world"}', '{"foo":"bar"}' ]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="form-data-with-binary-data">Form-data with binary data<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#form-data-with-binary-data" class="hash-link" aria-label="Direct link to Form-data with binary data" title="Direct link to Form-data with binary data">​</a></h2>
<p><img decoding="async" loading="lazy" alt="HTTP response of multipart/form-data with text and binary parts" src="https://kebetsi.github.io/assets/images/form-data-data-7cebb3e3c0f38ea9eb1568c18e8349a5.webp" width="1332" height="624" class="img_ev3q"></p>
<p>We change the <code>message2</code> part to be treated as a binary, while <code>message1</code> stays the same.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-server--with-libraries-1">JS server — with libraries<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#js-server--with-libraries-1" class="hash-link" aria-label="Direct link to JS server — with libraries" title="Direct link to JS server — with libraries">​</a></h3>
<p>We use a simple string for <code>message2</code>, but it accepts a Buffer object such as the bytes from a file given by the result of <code>fs.readFileSync()</code>.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'express'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> formData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'form-data'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const fs = require('fs');</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'9876'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'127.0.0.1'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">hello</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'world'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'foo=bar'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const message2 = fs.readFileSync('path/to/my/file');</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> requestHandler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">_</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">formData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message2'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Content-Type'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHeaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'content-type'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Content-Length'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getLengthSync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestHandler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'something bad happened'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">server is listening on </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">HOST</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">PORT</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-server--without-libraries-1">JS server — without libraries<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#js-server--without-libraries-1" class="hash-link" aria-label="Direct link to JS server — without libraries" title="Direct link to JS server — without libraries">​</a></h3>
<p>When sending binary data, we need to convert the string parts and separators using <a href="https://nodejs.org/api/buffer.html#static-method-bufferfromstring-encoding" target="_blank" rel="noopener noreferrer">Buffer.from()</a> and join them using <a href="https://nodejs.org/api/buffer.html#static-method-bufferconcatlist-totallength" target="_blank" rel="noopener noreferrer">Buffer.concat()</a>.</p>
<p>For the binary part, we need to add a <code>Content-Type</code> header inside the body.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> formData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'form-data'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const fs = require('fs');</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'9876'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'127.0.0.1'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">hello</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'world'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'foo=bar'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const message2 = fs.readFileSync('path/to/my/file');</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">requestHandler</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">chunk</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'end'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> boundary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'---------9051914041544843365972754266'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> contentTypeHeader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">multipart/form-data; boundary=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> firstPart </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Content-Disposition: form-data; name="message1"</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">message1</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Content-Disposition: form-data; name="message2"</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Content-Type: application/octet-stream</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> lastPart </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">boundary</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">--</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastPart </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">\r\n</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">firstPart</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lastPart</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> contentLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">writeHead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">'Content-Type'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contentTypeHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">'Content-Length'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> contentLength</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestHandler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HOST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'something bad happened'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">server is listening on </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">HOST</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">PORT</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client-1">Java client<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#java-client-1" class="hash-link" aria-label="Direct link to Java client" title="Direct link to Java client">​</a></h3>
<p>Now, the change is that the HTTP response body is a byte array, so we must manipulate bytes instead of Strings in our parsing function.</p>
<p>First, we translate the boundary in bytes using <code>boundary.getBytes()</code>.</p>
<p>Then we use custom <code>indexOf()</code> and <code>split()</code> methods that operate on bytes to separate the Form-Data parts. We must also trim the headers and body of the different parts.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpRequest</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpResponse</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">http</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">HttpResponse</span><span class="token import punctuation" style="color:#393A34">.</span><span class="token import class-name">BodyHandlers</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">URI</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">net</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">URISyntaxException</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">nio</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">charset</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">StandardCharsets</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">time</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Duration</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">util</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Arrays</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">util</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">LinkedList</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">util</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">List</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyClientData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">record</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> message1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseFormData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> contentTypeHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> responseBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> boundary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> contentTypeHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"boundary="</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> boundaryBytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> boundary</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ISO_8859_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> parts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">responseBody</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> boundaryBytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> part </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> parts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> separatorIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">part</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\r\n\r\n"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ISO_8859_1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">separatorIndex </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Skip if there's no body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// I remove the first 2 bytes, representing "\r\n" before the headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">copyOfRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">part</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> separatorIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// I remove the first 4 bytes and last 2.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// They are the "\r\n\r\n" before and "\r\n" after the payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">copyOfRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">part</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> separatorIndex </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> part</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">String</span><span class="token plain"> headersStr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StandardCharsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">UTF_8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headersStr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StandardCharsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">UTF_8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headersStr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message1 </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalStateException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Data missing from response"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">boolean</span><span class="token plain"> found </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          found </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">found</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> byteArrays </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LinkedList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delimiter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> byteArrays</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> begin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"> outer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      byteArrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">copyOfRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> begin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      begin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> delimiter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byteArrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">copyOfRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> begin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> byteArrays</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">MyApiResponse</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">HttpRequest</span><span class="token plain"> request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">HttpRequest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">url</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hello"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">HttpClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">HttpClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connectTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Duration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ofSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">HttpResponse</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BodyHandlers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ofByteArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> contentTypeHeader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">headers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">firstValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Content-Type"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">orElseThrow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalStateException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"No Content-Type header"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> responseBody </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">body</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseFormData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contentTypeHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> responseBody</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">URI</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">url</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">URISyntaxException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IllegalStateException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Invalid URI: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">MyApiResponse</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"localhost"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9876</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">message1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">message2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">StandardCharsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">UTF_8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// {"hello":"world"} foo=bar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-client-1">JS client<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#js-client-1" class="hash-link" aria-label="Direct link to JS client" title="Direct link to JS client">​</a></h3>
<p>For the JS client, we must call <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob/arrayBuffer" target="_blank" rel="noopener noreferrer">Blob.arrayBuffer()</a> to obtain the adequate interface.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">host</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">http://</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">host</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/hello</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">formData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message2'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> message2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">arrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">message1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'localhost'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9876</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// {"hello":"world"} foo=bar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://kebetsi.github.io/blog/Multipart-Form-data-response-parsing-in-Java-and-JavaScript#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>I wrote this article because I didn’t find much sources that explained how to parse Form-Data in an HTTP response. Most of what I found covers either the building of such a request or how to parse it on the server side.</p>
<p>I hope this helps other people implementing these parts, as I have strived to provide working code samples alongside my explanations.</p>
<p>Working on this task and writing this article has provided me a better understand of the Form-Data layout and the various HTTP library APIs around it.</p>]]></content:encoded>
            <category>JavaScript</category>
            <category>Java</category>
            <category>http</category>
            <category>response</category>
            <category>multipart-form-data</category>
        </item>
        <item>
            <title><![CDATA[MacOS software development tools]]></title>
            <link>https://kebetsi.github.io/blog/MacOS-software-development-tools</link>
            <guid>https://kebetsi.github.io/blog/MacOS-software-development-tools</guid>
            <pubDate>Wed, 04 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[I cover the different tools I use on MacOS to facilitate and speed up my work as a software developer.]]></description>
            <content:encoded><![CDATA[<p>I cover the different tools I use on MacOS to facilitate and speed up my work as a software developer.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="terminal">Terminal<a href="https://kebetsi.github.io/blog/MacOS-software-development-tools#terminal" class="hash-link" aria-label="Direct link to Terminal" title="Direct link to Terminal">​</a></h2>
<p>I use <a href="https://iterm2.com/" target="_blank" rel="noopener noreferrer">iTerm2</a> as my terminal. It allows me to split my screen into multiple parts when I need to monitor multiple processes on a single screen. <code>CMD+D</code> and <code>CMD+Shift+D</code> for horizontal and vertical split respectively. One setting I always tweak is the <a href="https://stackoverflow.com/questions/12459755/zsh-iterm2-increase-number-of-lines-history/28608448#28608448" target="_blank" rel="noopener noreferrer">line buffer size</a>.</p>
<p><img decoding="async" loading="lazy" alt="multiplexing with iTerm2" src="https://kebetsi.github.io/assets/images/iterm-f15d69a61d58e063498e7b4d9717085a.webp" width="3456" height="2162" class="img_ev3q"></p>
<p>As a shell, I use <a href="https://ohmyz.sh/#install" target="_blank" rel="noopener noreferrer">Oh My Zsh</a> for its out-of-the-box <a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Plugins" target="_blank" rel="noopener noreferrer">plugins</a> offering shortcuts and because it displays my current branch in git repositories. My main shortcuts are for git and folder navigation:</p>
<ul>
<li><code>gco</code>: git checkout</li>
<li><code>gm</code>: git merge</li>
<li><code>gl</code>: git pull</li>
<li><code>gp</code>: git push</li>
<li><code>ll</code>: ls -l</li>
<li><code>..</code> and <code>...</code>, etc: <code>cd ..</code>, <code>cd ../..</code>, etc</li>
</ul>
<p>For folder navigation, I also use <a href="https://github.com/wting/autojump" target="_blank" rel="noopener noreferrer">autojump</a> which allows me to jump quickly between folders I visited like <code>j my-repo</code>. It matches the target folder by name and number of visits.</p>
<p>I don’t like the wall of text that <code>man</code> pages usually output, so I use <a href="https://tldr.sh/" target="_blank" rel="noopener noreferrer">tldr pages</a>.</p>
<p><img decoding="async" loading="lazy" alt="TL;DR of ln command" src="https://kebetsi.github.io/assets/images/tldr-a10943571db88302db302ca0813f8fee.webp" width="966" height="530" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="git-client">Git client<a href="https://kebetsi.github.io/blog/MacOS-software-development-tools#git-client" class="hash-link" aria-label="Direct link to Git client" title="Direct link to Git client">​</a></h2>
<p>I use <a href="https://jonas.github.io/tig/" target="_blank" rel="noopener noreferrer">tig</a> as a CLI git client, it’s a fast tool that allows me to stage files, cherry-picking blocks of codes or lines if needed. Navigating through the log is very convenient as it supports the same search keys as <code>less</code>. Here is a <a href="https://www.atlassian.com/blog/git/git-tig" target="_blank" rel="noopener noreferrer">great article</a> about it.</p>
<p><img decoding="async" loading="lazy" alt="Status view in tig" src="https://kebetsi.github.io/assets/images/tig-890beafcabc9b36469c773829f0a2f7f.webp" width="2412" height="1164" class="img_ev3q"></p>
<p>You can open the log view with <code>tig</code>, but I recommend setting up this alias to open <strong>tig</strong> in Status view directly: <code>alias s="tig status"</code>. If you use “Oh My Zsh”, you should append this in <code>~/.zshrc</code>.</p>
<p>I configure <code>git</code> to track remote branches automatically: <code>git config --global --add --bool push.autoSetupRemote true</code>.</p>
<p>Also, I prefer that <code>git branch</code> (or <code>gb</code>) doesn’t pipe its output in less with <code>git config --global pager.branch false</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nodejs">Node.js<a href="https://kebetsi.github.io/blog/MacOS-software-development-tools#nodejs" class="hash-link" aria-label="Direct link to Node.js" title="Direct link to Node.js">​</a></h2>
<p>I use <a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener noreferrer">nvm</a> to work with multiple versions of Node.js. You can install a new version like 20 with your global dependencies using: <code>nvm install 20 --reinstall-from=current</code>.</p>
<p><img decoding="async" loading="lazy" alt="Print installed Node.js versions, the one in use and the default one" src="data:image/webp;base64,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" width="860" height="278" class="img_ev3q"></p>
<p>Switch between versions easily with <code>nvm use 18</code> and update your default with <code>nvm alias default 20</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="javascripttypescript-ide">JavaScript/TypeScript IDE<a href="https://kebetsi.github.io/blog/MacOS-software-development-tools#javascripttypescript-ide" class="hash-link" aria-label="Direct link to JavaScript/TypeScript IDE" title="Direct link to JavaScript/TypeScript IDE">​</a></h2>
<p>As the majority of people, I use the <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer">VS code</a> IDE for JS/TS.</p>
<p><img decoding="async" loading="lazy" alt="VS code IDE" src="https://kebetsi.github.io/assets/images/vscode-a741270e4ad8f93ca5817cde8b7bb064.webp" width="2368" height="1086" class="img_ev3q"></p>
<p>I open it from the terminal using <code>code .</code> which you can set up <a href="https://code.visualstudio.com/docs/setup/mac#_launching-from-the-command-line" target="_blank" rel="noopener noreferrer">like that</a>.</p>
<p>For extensions:</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens" target="_blank" rel="noopener noreferrer">GitLens</a> provides blame information on lines of code, for context</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=firsttris.vscode-jest-runner" target="_blank" rel="noopener noreferrer">Jest runner</a> easily runs single test suites from the IDE, with a debugger if needed</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint" target="_blank" rel="noopener noreferrer">ESLint</a>, <a href="https://marketplace.visualstudio.com/items?itemName=SonarSource.sonarlint-vscode" target="_blank" rel="noopener noreferrer">SonarLint</a>, <a href="https://marketplace.visualstudio.com/items?itemName=timonwong.shellcheck" target="_blank" rel="noopener noreferrer">Shellcheck</a>, and <a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" target="_blank" rel="noopener noreferrer">Prettier</a> in the linter department</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="java">Java<a href="https://kebetsi.github.io/blog/MacOS-software-development-tools#java" class="hash-link" aria-label="Direct link to Java" title="Direct link to Java">​</a></h2>
<p>I use <a href="https://sdkman.io/" target="_blank" rel="noopener noreferrer">sdkman</a> to install and switch between Java versions.</p>
<p><img decoding="async" loading="lazy" alt="Available Java version, highlighting installed and in use" src="https://kebetsi.github.io/assets/images/sdkman-7f84283ed270b9e6fcff63b856f0406d.webp" width="1140" height="660" class="img_ev3q"></p>
<p>I use <a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener noreferrer">IntelliJ</a> as an IDE for Java. It has a lot more built-in tools for Java development and beats VS code to it. It requires some time to learn all the shortcuts that will make you a power user but makes up for the loading time it spends indexing the projects.</p>
<p><img decoding="async" loading="lazy" alt="IntelliJ IDE" src="https://kebetsi.github.io/assets/images/intellij-b609a9d56d26e05df119063de0909d5d.webp" width="1936" height="1428" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc">Misc<a href="https://kebetsi.github.io/blog/MacOS-software-development-tools#misc" class="hash-link" aria-label="Direct link to Misc" title="Direct link to Misc">​</a></h2>
<p>For many of the tools here, I used <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">homebrew</a> to install them.</p>
<p><img decoding="async" loading="lazy" alt="List of packages installed with homebrew" src="https://kebetsi.github.io/assets/images/homebrew-4a112b21627a8993bda58e2574ea1acb.webp" width="1648" height="192" class="img_ev3q"></p>
<p>For app multiplexing on the desktop, I use <a href="https://apps.apple.com/us/app/moom-classic/id419330170?mt=12" target="_blank" rel="noopener noreferrer">Moom</a> which is a paid tool. It allows me to resize apps to fit half or a quarter of a screen like on Windows.</p>]]></content:encoded>
            <category>MacOS</category>
            <category>JavaScript</category>
            <category>Java</category>
            <category>tools</category>
        </item>
        <item>
            <title><![CDATA[Inter-process synchronization in Java using FileLock]]></title>
            <link>https://kebetsi.github.io/blog/Inter-process-synchronization-in-Java-using-FileLock</link>
            <guid>https://kebetsi.github.io/blog/Inter-process-synchronization-in-Java-using-FileLock</guid>
            <pubDate>Sun, 01 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[On a work project, we needed to fix a concurrency issue where multiple processes would write at the same time in the same file, which led to file corruption.]]></description>
            <content:encoded><![CDATA[<p>On a work project, we needed to fix a concurrency issue where multiple processes would write at the same time in the same file, which led to file corruption.</p>
<p><img decoding="async" loading="lazy" alt="2 processes synchronize their writes on data using a FileLock" src="data:image/webp;base64,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" width="1252" height="420" class="img_ev3q"></p>
<p>To fix this issue, we have opted to use the Java <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/channels/FileLock.html" target="_blank" rel="noopener noreferrer">FileLock</a> that has been available since Java 1.4.</p>
<p>This allows for multiple processes, not threads, to synchronize by writing the lock into a file. If, like in my use case, you want to synchronize file writing, you should use a dedicated/separate file for locking. Using the file you intend to read or execute for locking will lead to it being corrupted, as the FileLock will modify it.</p>
<p>Obtaining a FileLock requires creating a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/FileOutputStream.html" target="_blank" rel="noopener noreferrer">FileOutputStream</a>, obtaining a <a href="https://docs.oracle.com/javase/8/docs/api/index.html?java/nio/channels/FileChannel.html" target="_blank" rel="noopener noreferrer">FileChannel</a> on it, and calling <code>FileChannnel.lock()</code> or <code>FileChannel.tryLock()</code>:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FileOutputStream</span><span class="token plain"> fos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileOutputStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"lockFile"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FileChannel</span><span class="token plain"> channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FileLock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tryLock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lock </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// do stuff while you have an exclusive lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// do something else or wait since another process has acquired the lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you are using <code>FileChannel.lock()</code>, upon failure to obtain it, the function will raise an exception, so you will need to handle that case in the catch block and not the <code>lock != null</code> else clause:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FileOutputStream</span><span class="token plain"> fos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileOutputStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"lockFile"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FileChannel</span><span class="token plain"> channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FileLock</span><span class="token plain"> lock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// do stuff while you have an exclusive lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">OverlappingFileLockException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// do something else or wait since another process has acquired the lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>Java</category>
            <category>synchronization</category>
            <category>process</category>
            <category>locking</category>
        </item>
        <item>
            <title><![CDATA[Run Unity game on Raspberry Pi 4 with Picade arcade machine]]></title>
            <link>https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine</link>
            <guid>https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine</guid>
            <pubDate>Tue, 06 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[A friend approached me to help him install a game he implemented with Unity on his Raspberry Pi 4B (4GB) bundled with a Picade retro arcade machine. Here are the steps we followed to install it.]]></description>
            <content:encoded><![CDATA[<p>A friend approached me to help him install a game he implemented with <a href="https://unity.com/" target="_blank" rel="noopener noreferrer">Unity</a> on his Raspberry Pi 4B (4GB) bundled with a Picade retro arcade machine. Here are the steps we followed to install it.</p>
<p><img decoding="async" loading="lazy" alt="The game running on the Picade arcade" src="https://kebetsi.github.io/assets/images/picade-96485b7c25f2a49c73fe61a959ad620c.webp" width="2048" height="1536" class="img_ev3q"></p>
<p>The main issue was that the Raspberry board is powered by an ARM CPU which is not compatible with the x86_64 builds that Unity could do. We have tried running an Android build of the game, but it did not launch. The game itself is a retro platformer with limited graphical features, therefore we finally went with the WebGL approach, running the game in a browser on the Raspberry Pi.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ul>
<li><a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/" target="_blank" rel="noopener noreferrer">Raspberry Pi 4B</a></li>
<li><a href="https://shop.pimoroni.com/products/picade?variant=29210087489619" target="_blank" rel="noopener noreferrer">Picade</a></li>
<li>micro SD card, at least 4 GB</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="write-the-os-image-to-the-sd-card">Write the OS image to the SD card<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#write-the-os-image-to-the-sd-card" class="hash-link" aria-label="Direct link to Write the OS image to the SD card" title="Direct link to Write the OS image to the SD card">​</a></h2>
<p>We have used <a href="https://www.raspberrypi.com/software/" target="_blank" rel="noopener noreferrer">Raspberry Pi Imager</a> to write the recommended Raspberry Pi OS (32-bit) to the SD card.</p>
<p><img decoding="async" loading="lazy" alt="Raspberry Pi Imager" src="https://kebetsi.github.io/assets/images/imager-85de585e303e47bbcabf62454330082b.webp" width="1584" height="1108" class="img_ev3q"></p>
<p>Once the writing is done, plug the SD card into the Raspberry and boot it, filling the prompts as they come. We recommend to change the default password as otherwise an alert window will show up at boot. We changed it to a simple <code>raspberry2</code> as security is not a requirement.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-the-raspberry-pi-via-wifi">Connect to the Raspberry Pi via WiFi<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#connect-to-the-raspberry-pi-via-wifi" class="hash-link" aria-label="Direct link to Connect to the Raspberry Pi via WiFi" title="Direct link to Connect to the Raspberry Pi via WiFi">​</a></h2>
<p>As we had to copy some files on the Raspberry, it was convenient to connect to it via SSH over WiFi (my machine doesn’t have Ethernet ports).</p>
<p>You need to first connect the Raspberry to the WiFi. We connected a keyboard to it in order to enter the password, as well as a mouse to navigate the menus.</p>
<p>Once it is done, you need to activate the SSH interface:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Preferences Menu &gt; Raspberry Pi Configuration &gt; Interfaces Tab &gt; Enable SSH &gt; OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then from your machine you can connect to it by running:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh pi@raspberrypi.local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and entering your password (<code>raspberry2</code> for us).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-game">Deploy game<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#deploy-game" class="hash-link" aria-label="Direct link to Deploy game" title="Direct link to Deploy game">​</a></h2>
<p>A WebGL build needs to be served by a web server, a browser cannot simply open the <code>index.html</code> file. We have therefore used <a href="https://nginx.org/en/" target="_blank" rel="noopener noreferrer">NGINX</a> for this task.</p>
<ol>
<li>Export a WebGL build to your machine in <code>${game-dir}</code></li>
<li>On the Raspberry, create a directory for the game: <code>mkdir /home/pi/game</code></li>
<li>Copy the build from your machine to the Raspberry: <code>scp -r ${game-dir} pi@raspberrypi.local:/home/pi/game</code></li>
<li>Install NGINX on the Raspberry: <code>sudo apt install nginx</code></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="point-the-default-web-server-to-the-game-folder">Point the default web server to the game folder<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#point-the-default-web-server-to-the-game-folder" class="hash-link" aria-label="Direct link to Point the default web server to the game folder" title="Direct link to Point the default web server to the game folder">​</a></h2>
<p>For the following, we used <code>vim</code> to edit files, which can be installed with: <code>sudo apt install vim</code>.</p>
<ol>
<li>Open an editor in the default server: <code>sudo vim /etc/nginx/sites-enabled/default</code></li>
<li>Change this line: <code>root /var/www/html;</code></li>
<li>To: <code>root /home/pi/game/${game-dir};</code></li>
<li>Save and close <code>vim</code>: ESC + <code>:wq</code></li>
<li>Launch NGINX: <code>sudo /etc/init.d/nginx start</code></li>
</ol>
<p>NGINX will run at boot, so there is no need of additional setup.</p>
<p>The game should now be available when opening <a href="http://localhost/" target="_blank" rel="noopener noreferrer">http://localhost</a> in a web browser on the Raspberry. You can also open such a window from your machine through SSH using:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DISPLAY=:0 chromium-browser --start-fullscreen http://localhost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-picade-driver">Install Picade driver<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#install-picade-driver" class="hash-link" aria-label="Direct link to Install Picade driver" title="Direct link to Install Picade driver">​</a></h2>
<p>Run:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -sS https://get.pimoroni.com/picadehat | bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then reboot the Raspberry Pi with: <code>sudo reboot</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-the-keys-mapping">Setup the keys mapping<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#setup-the-keys-mapping" class="hash-link" aria-label="Direct link to Setup the keys mapping" title="Direct link to Setup the keys mapping">​</a></h2>
<p>You need to edit the <code>/boot/config.txt</code> file to set key mappings for the Picade Arcade. We display our example hereafter, but you can find all <a href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/input-event-codes.h" target="_blank" rel="noopener noreferrer">key codes in their definition file</a>.</p>
<p>Open the config file: <code>vim /boot/config.txt</code> and add the following under <code>[all]</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[all]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtoverlay=picade # should already be present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=escape=114 # volume down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=enter=115 # volume up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=start=25 # p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=coin=113 # mute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=button1=24 # o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=button4=37 # k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=up=17 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=down=31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=left=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=right=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=button2=23 # i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=button3=22 # u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=button5=36 # j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtparam=button6=35 # h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="start-fullscreen-browser-with-game-on-boot">Start fullscreen browser with game on boot<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#start-fullscreen-browser-with-game-on-boot" class="hash-link" aria-label="Direct link to Start fullscreen browser with game on boot" title="Direct link to Start fullscreen browser with game on boot">​</a></h2>
<p>We have used <strong>autostart</strong> to run the browser at boot since it is a GUI application.</p>
<ol>
<li>Open a new file with: <code>vim /etc/xdg/autostart/game-browser.desktop</code> (the <code>.desktop</code> extension is important!)</li>
<li>Write the following inside:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Desktop Entry]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name=Chrome</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exec=chromium-browser --noerrors --disable-session-crashed-bubble --disable-infobars --kiosk http://localhost --incognito</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We need the <code>--noerrors --disable-session-crashed-bubble --disable-infobars --incognito</code> options to avoid the “restore pages” pop-up after reboot. The <code>--kiosk</code> option prevents displaying the “Press F11 to exit fullscreen” message at boot.</p>
<p><a href="https://gist.github.com/kebetsi/f251cbf6dac7a4a6dcf74a0e9e177665" target="_blank" rel="noopener noreferrer">The default <code>index.html</code></a> file provided in Unity’s WebGL build does not display the game in fullscreen. We had to change the <code>body</code> in the <code>/home/pi/game/${game-directory}/index.html</code> file to this:</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value" style="color:#e3116c">”webgl-content”</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value" style="color:#e3116c">”unityContainer”</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">”width</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">1152px;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">height:</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">864px”</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The values for <code>width</code> and <code>length</code> have been set according to the Picade screen. We have also removed the footer with the Unity logo.</p>
<p>You can find the full example: <a href="https://gist.github.com/kebetsi/ba6c60c653257e04cbb866080ed96e02" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-sound">Fix sound<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#fix-sound" class="hash-link" aria-label="Direct link to Fix sound" title="Direct link to Fix sound">​</a></h2>
<p>Booting chromium in kiosk mode has muted the sound on the Raspberry. This required the player to unmute the game to activate the sound after each boot. We have done the following to ensure it is on:</p>
<ol>
<li>Unmute the game manually with the mouse</li>
<li>Save the setting by running: <code>sudo alsactl store</code></li>
</ol>
<p>We still require to press any button from the start screen to activate sound, which seems to be the case because we’re out of focus from the chromium window, but we deemed it sufficient.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cleanup-background-to-display-on-load">Cleanup background to display on load<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#cleanup-background-to-display-on-load" class="hash-link" aria-label="Direct link to Cleanup background to display on load" title="Direct link to Cleanup background to display on load">​</a></h2>
<p>When the Raspberry Pi will boot, we do not wish to display the default Raspberry Pi OS desktop, but a custom image.</p>
<p>Setup the wallpaper you wish by going:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Preferences Menu &gt; Raspberry Pi Configuration &gt; Desktop Tab &gt; Picture</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Hide the trash icon by unchecking <code>Wastebasket</code> in the same menu.</p>
<p>Finally we have hidden the taskbar by right-clicking on it, then on <code>Panel Settings</code>, then going to the <code>Advanced</code> tab and checking <code>Minimize panel when not in use</code>. We have also set its default size to a minimum by setting its <code>width</code> to <code>0%</code> and <code>height</code> to the minimum <code>16 pixels</code>. It slightly appears on the top left corner, but it was sufficient for our use case.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hide-mouse-tracker">Hide mouse tracker<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#hide-mouse-tracker" class="hash-link" aria-label="Direct link to Hide mouse tracker" title="Direct link to Hide mouse tracker">​</a></h2>
<ol>
<li>Open the GUI config file: <code>vim /etc/lightdm/lightdm.conf</code></li>
<li>under <code>[Seat:*]</code>, add the following line: <code>xserver-command=X -nocursor</code></li>
</ol>
<p>This makes the mouse tracker invisible, but you are still be able to use it if needed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-result">The result<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#the-result" class="hash-link" aria-label="Direct link to The result" title="Direct link to The result">​</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ZARZHkZeiZA?si=tq9StkyvSq8QdeZJ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="try-the-game">Try the game<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#try-the-game" class="hash-link" aria-label="Direct link to Try the game" title="Direct link to Try the game">​</a></h2>
<p>We have published the game online, <a href="https://astro.toys/Kekkon-Quest/" target="_blank" rel="noopener noreferrer">you can try it here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sources">Sources<a href="https://kebetsi.github.io/blog/Run-Unity-game-on-Raspberry-Pi-4-with-Picade-arcade-machine#sources" class="hash-link" aria-label="Direct link to Sources" title="Direct link to Sources">​</a></h2>
<ul>
<li>Raspberry Pi imager: <a href="https://www.raspberrypi.org/software/" target="_blank" rel="noopener noreferrer">https://www.raspberrypi.org/software/</a></li>
<li>Connect to Raspberry via WiFi: <a href="https://medium.com/@nikosmouroutis/how-to-setup-your-raspberry-pi-and-connect-to-it-through-ssh-and-your-local-wifi-ac53d3839be9" target="_blank" rel="noopener noreferrer">https://medium.com/@nikosmouroutis/how-to-setup-your-raspberry-pi-and-connect-to-it-through-ssh-and-your-local-wifi-ac53d3839be9</a></li>
<li>Install NGINX on Raspberry Pi: <a href="https://www.raspberrypi.org/documentation/remote-access/web-server/nginx.md" target="_blank" rel="noopener noreferrer">https://www.raspberrypi.org/documentation/remote-access/web-server/nginx.md</a></li>
<li>Install Picade driver: <a href="https://learn.pimoroni.com/tutorial/sandyj/getting-started-with-picade-hat" target="_blank" rel="noopener noreferrer">https://learn.pimoroni.com/tutorial/sandyj/getting-started-with-picade-hat</a></li>
<li>Setup Picade keys mapping: <a href="https://github.com/pimoroni/picade-hat" target="_blank" rel="noopener noreferrer">https://github.com/pimoroni/picade-hat</a></li>
<li>Stop “restore pages” pop-up: <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=212015" target="_blank" rel="noopener noreferrer">https://www.raspberrypi.org/forums/viewtopic.php?t=212015</a></li>
<li>Unmute sound: <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=169216" target="_blank" rel="noopener noreferrer">https://www.raspberrypi.org/forums/viewtopic.php?t=169216</a></li>
<li>Hide Mouse: <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=234879" target="_blank" rel="noopener noreferrer">https://www.raspberrypi.org/forums/viewtopic.php?t=234879</a></li>
</ul>]]></content:encoded>
            <category>Raspberry Pi</category>
            <category>Unity</category>
            <category>Raspbian</category>
            <category>Retro Gaming</category>
        </item>
    </channel>
</rss>